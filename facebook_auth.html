<!doctype html>
<html>

    <head></head>

    <body>

      <script>
          var templateSessionID = "{{ session_id }}";
      </script>

      <script src="/static/jquery-3.5.1.min.js"></script>
      <script src="/static/jquery.firebaseLocal.js"></script>

      <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-analytics.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>

      <script>
          var firebaseConfig = {
            apiKey: "AIzaSyAzPmBPcIIkNK9KUzRLQ0AnHQjQWydSBKI",
            authDomain: "size-adviser.firebaseapp.com",
            databaseURL: "https://size-adviser.firebaseio.com",
            projectId: "size-adviser",
            storageBucket: "size-adviser.appspot.com",
            messagingSenderId: "862763273858",
            appId: "1:862763273858:web:12e4a2ea44b1053f6dee9b"
          };
          firebase.initializeApp(firebaseConfig);

          var provider = new firebase.auth.FacebookAuthProvider();

          function runLogin() {


              provider.addScope("email");
              provider.addScope("user_gender");

              firebase.auth().useDeviceLanguage();

              firebase.auth().signInWithRedirect(provider);
          }


          firebase.auth().onAuthStateChanged(function(user) {
              if (user) {
                console.log();
              } else {
                runLogin();
              }
          });

          firebase.auth().getRedirectResult().then(function(result) {
              if (result.credential) {
                var token = result.credential.accessToken;
                var user = result.user;

                firebaseLocal.setSessionData(
                    templateSessionID, user.email, user.displayName,
                    function () {
                        $("#auth_msg").html("You are now logged in! Please now proceed back to the app");
                    }, window.close
                );
              }
            }).catch(function(error) {
              var errorCode = error.code;
              var errorMessage = error.message;
              var email = error.email;
              var credential = error.credential;
          });
       </script>

       <div id="auth_msg">
           If your browser does not redirect you automatically, click the button below...
           <br><br>
           <button onclick="runLogin()">Authorize using Facebook</button>
       </div>
    </body>

</html>